<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script>

  // Create a club
  // $('#create').on('submit', function(event) {
  //   const form = $(this);
  //   event.preventDefault();
  //
  //   $.ajax({method: 'post', url: '/clubs', data: form.serialize()})
  //     .done(id => window.location.replace(`/clubs/${id}`))
  //     .fail(error => alert('Fail to create the club.'));
  // });



  $('#join').on('click', function(event) {
    const form = $(this);
    event.preventDefault();
    // const curURL = window.location.href
    // const lst = curURL.split("/");
    // const curClub = lst[lst.length-1].replace(/%20/g,"");
    // console.log(curClub);

    // $.ajax({method: 'get', url: '/clubs/:id', data:{id:curClub}}).
    // then(function(){
    //   const currentClub=clubs.find(club=>club._id = curClub);
    //   if (currentClub.memberList.indexOf(request.session.user)<0){
    //     currentClub.memberList.push(request.session.user);
    //     $.$.ajax({method: 'put', url: '/clubs/:id', data:{id:currentClub.memberList}})
    //   };
    // })
    // //.done(club => window.location.replace(`/clubs/${club}`))
    //   .fail(alert('You are already in this club/theme house.'));
    // }

    <%_ if (club.memberList.indexOf(user._id) < 0) { -%>
      <%_newMemberList = club.memberList.push(user._id)-%>;
    //  console.log(club);
        <%_console.log(newMemberList);-%>


      $.ajax({method: 'put', url: '/clubs/<%= club._id -%>', data: function(club){
        club.memberList = newMemberList;
      }})
        //d.memberList = newMemberList;
      //}})
      <%_ } else {-%>
     .fail(error => alert('You are already in the club.'));
   <%_ }-%>
        .done(() => alert('Join in successfully.'))
        .done(() => window.location.replace('/clubs'))
        .fail(error => alert('Fail to join in this club.'));




  });
</script>
